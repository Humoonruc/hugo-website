[TOC]



## 03 SVG

Scalable Vector Graphic

SVG教程：https://www.runoob.com/svg/svg-tutorial.html

### 坐标系和单位

像素坐标系，以画布的左上角为原点。横轴向右，纵轴向下。

`weith` 和 `height` 属性，默认以像素 px 为单位，但也可以显式给出其他单位，如 em 等相对单位和 cm、mm 等绝对单位。

### 标签 tag

#### 基本形状

`rect`, `circle`, `ellipse`, `line`, `polyline`, `polygon`, `path`

形状以外的标签还包括 `g`, `text`, `tspan`, `title`等。

```html
<body>
  <svg width="800" height="600">

    <!-- 矩形，参数分别为左上角相对坐标，圆角的半径，矩形的宽高，颜色和透明度 -->
    <rect x="500" y="300" rx="20" ry="20" width="200" height="100"
      style="fill: steelblue; stroke:black; stroke-width:10; opacity:0.5" />

    <!-- 圆和椭圆，cx和cy用于指定圆心坐标，r指定半径 -->
    <circle cx="100" cy="450" r="25" fill="blue" stroke="gray" stroke-width="5" />
    <ellipse cx="250" cy="425" rx="50" ry="15" />

    <!-- line画直线，四个坐标指定起点和终点，stroke指定颜色 -->
    <line x1="0" y1="350" x2="500" y2="300" style=" stroke:black; stroke-width:4" />

    <!-- polyline画折线，points参数是一系列坐标，起点和终点不连接 -->
    <polyline points="100,20 20,90 60,160 140,160 180,90" style=" fill:white; stroke:black; stroke-width:3 "
      transform="translate(500,0)" />

    <!-- polygon画多边形，points参数是一系列坐标，起点和终点连接 -->
    <polygon points="100,20 20,90 60,160 140,160 180,90" style=" fill:LawnGreen; stroke:black; stroke-width:3 " />

    <!-- path中d属性的a表示椭圆曲线 -->
    <path d="M100,200 a200,150 0 1,0 150,-150 Z" stroke="blue" stroke-width="4"
      style="opacity: 0.5; fill:yellowgreen" />

    <!-- text渲染文本，x指定左边缘横坐标，y指定字体基线位置，dx、dy指定相对于当前位置平移的距离，textLength拉伸宽度，rotate字符旋转角度-->
    <text x="0" y="0" dx="200" dy="200" font-size="40" textLength="200" rotate='-15'>
      I love <tspan fill="red">D3</tspan>
    </text>

  </svg>
</body>
```



#### group

最特殊的是`g`节点，代表 group，用于控制一组对象，如==数轴 axis、图例 legend==。

注意：`g`节点没有x, y属性，要移动它必须用`g.attr("transform", "transplant()")`

### 样式

1. SVG 默认黑色填充，无描边

2. 常用样式属性

   1. `fill` 填充颜色
   2. `stroke` 描边颜色
   3. `stroke-width` 描边宽度
   4. `stroke-linecap` 线头端点的样式，圆角、直角等
   5. `stroke-dasharray` 使线条变为虚线。如属性值`"2,3"`表示长度比例为2：3的线段与空白的循环
   6. `opacity` 透明度（0为完全透明，1为完全不透明）
   7. `font-family`字体，`font-size`字号，`font-weight`字体粗细，`font-style`字体样式（斜体等）
   8. `text-decoration` 上划线、下划线等

3. 可以用 css 给出样式，但`fill`, `stroke`和`stroke-width`不是标准的 css 属性。虽然也能用，但建议在包含这三个属性的选择符中增加 svg 标记：

   ```css
   svg .pumpkin{
       fill: yellow;
       stroke: orange;
       stroke-width: 5;
   }
   ```

### 标记

可以定义一个标记以重复运用，如下例定义的 arrow 标记

```html
<body>
  <svg width="800" height="600">
    <defs>
      <marker id="arrow" markerUnits="strokeWidth" markerWidth="12" markerHeight="12" viewBox="0 0 12 12" refX="6"
        refY="6" orient="auto">
        <path d="M2,2 L10,6 L2,10 L6,6 L2,2" style="fill: #000000;" />
      </marker>
    </defs>

    <line x1="0" y1="0" x2="200" y2="50" stroke="red" stroke-width="2" marker-end="url(#arrow)" />

    <path d="M20,70 T80,100 T160,80 T200,90" fill="white" stroke="red" stroke-width="2" marker-start="url(#arrow)"
      marker-mid="url(#arrow)" marker-end="url(#arrow)" />
  </svg>
</body>
```

### 滤镜

```html
<body>
  <svg width="600" height="600" version="1.1" xmlns="http://www.w3.org/2000/svg">

    <defs>
      <filter id="GaussianBlur">
        <feGaussianBlur in="SourceGraphic" stdDeviation="2" />
      </filter>
    </defs>

    <rect x="100" y="100" width="150" height="100" fill="blue" />

    <rect x="300" y="100" width="150" height="100" fill="blue" filter="url(#GaussianBlur)" />

  </svg>
</body>
```

### 渐变

`<defs></defs>`

```svg
<svg width="600" height="600" version="1.1" xmlns="http://www.w3.org/2000/svg">

  <defs>
    <linearGradient id="myGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" stop-color="#F00" />
      <stop offset="100%" stop-color="#0FF" />
    </linearGradient>
  </defs>

  <rect fill="url(#myGradient)" x="10" y="10" width="300" height="100" />

</svg>
```

### 重叠与蒙版

1. 若几个元素出现了重叠，则DOM中越靠后的元素，出现在最终图形的越上层。
   1. 数轴和标签建议最后添加，防止被图形元素遮挡
   2. 或利用透明效果，解决相互遮挡的问题
   3. `opacity`属性会统一规定一个节点的透明度，若希望==主体和描边的透明度不同，可以给它们上不同的颜色，颜色代码中包含透明度==（如rgba()格式的颜色）
   4. 对已经用rgba()设置了颜色的元素再应用`opacity`属性，透明度值会相乘。
2. 蒙版

clipPath 是一个 SVG 元素，可以包含可见的元素，并与这个可见元素一起构成可以应用到其他元素的剪切路径或蒙版。元素应用了蒙版后，==只有落在该蒙版形状内部的像素才会显示==。

与 g 元素相似，clipPath 元素本身也不可见，但它可以包含可见的元素（这些元素用作蒙版）。

```javascript
    //Define clipping path
    svg.append("clipPath")
      .attr("id", "chart-area")
      .append("rect") //这个clipPath内部有一个rect元素，作为蒙版。落在它范围之外的元素不会被显示。
      .attr("x", padding)
      .attr("y", padding)
      .attr("width", w - padding * 3)
      .attr("height", h - padding * 2);

//Create circles
    svg.append("g") //一个组节点，节省代码。其下所有的圆都将适用同一个蒙版
      .attr("id", "circles")
      .attr("clip-path", "url(#chart-area)") //引用上述clipPath
      .selectAll("circle")
      .data(dataset)
      .enter()
      .append("circle")
      .attr("cx", function (d) {
        return xScale(d[0]);
      })
      .attr("cy", function (d) {
        return yScale(d[1]);
      })
      .attr("r", 2);
```

